<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Invent√°rio de Esquemas de Young - Cleo Martins</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --cream: #F7F4EF;
    --sage: #4A2F26;
    --terracotta: #C38A6B;
    --gray-mid: #7A6560;
    --border: #E4DDD5;
    --shadow: rgba(74,47,38,0.07);
    --error-red: #A84848;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--cream); color: var(--sage); min-height: 100vh; font-size: 15px; }

  /* HEADER */
  .header { background: #F7F4EF; border-bottom: 1px solid var(--border); padding: 18px 32px; display: flex; align-items: center; gap: 14px; position: sticky; top: 0; z-index: 100; box-shadow: 0 1px 8px var(--shadow); }
  .header-logo { width: 36px; height: 36px; background: var(--sage); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .header-title { font-family: 'Lora', serif; font-size: 17px; font-weight: 600; }
  .progress-bar-wrap { margin-left: auto; display: flex; align-items: center; gap: 12px; min-width: 200px; }
  .progress-track { flex:1; height: 6px; background: #DDD8D0; border-radius: 99px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--sage); transition: width 0.4s ease; width: 0%; }

  /* INTRO & FORMS */
  .container-wide { max-width: 760px; margin: 60px auto; padding: 0 24px; }
  .screen { display: none; }
  .screen.active { display: block; }
  .intro-heading { font-family: 'Lora', serif; font-size: 38px; margin-bottom: 24px; }
  .instructions-box, .patient-form { background: #FFF; border: 1px solid var(--border); border-radius: 16px; padding: 32px; margin-bottom: 30px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 15px; }
  .form-group label { font-size: 11px; text-transform: uppercase; color: var(--gray-mid); font-weight: 600; display: block; margin-bottom: 5px; }
  .form-group input { width: 100%; border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: var(--cream); outline: none; }

  /* QUESTION CARDS */
  .question-card { background: #FFF; border: 1px solid var(--border); border-radius: 14px; padding: 24px; margin-bottom: 16px; transition: 0.2s; }
  .question-card.answered { border-color: #D4C8C2; box-shadow: 0 2px 8px var(--shadow); }
  .question-card.missing { border: 2px solid var(--error-red); background: #FFF9F9; }
  .question-num { width: 28px; height: 28px; border: 1.5px solid #DDD; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; margin-bottom: 15px; }
  .question-card.answered .question-num { background: var(--terracotta); border-color: var(--terracotta); color: #FFF; }
  .question-text { font-size: 15px; line-height: 1.6; margin-bottom: 20px; }

  /* SCALE BUTTONS WITH LABELS */
  .scale-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .scale-btn { 
    background: var(--cream); border: 1.5px solid var(--border); border-radius: 10px; padding: 12px 8px; cursor: pointer; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .scale-btn strong { font-size: 16px; margin-bottom: 2px; }
  .scale-btn span { font-size: 9px; line-height: 1.2; color: var(--gray-mid); font-weight: 400; }
  .scale-btn.selected { background: var(--sage); border-color: var(--sage); color: #FFF; }
  .scale-btn.selected span { color: #EEE; }

  /* NAVIGATION */
  .btn-action { width: 100%; padding: 16px; background: var(--sage); color: #FFF; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 16px; transition: 0.2s; }
  .btn-action:hover { background: #321f18; }
  .nav-row { display: flex; justify-content: space-between; gap: 20px; margin-top: 30px; }
  .btn-nav { padding: 14px 24px; border-radius: 10px; border: 1.5px solid var(--border); cursor: pointer; font-weight: 500; }
  .btn-nav.primary { background: var(--sage); color: #FFF; border: none; }

  /* RESULTS */
  .patient-summary { background: #FFF; border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 30px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
  .score-card { background: #FFF; border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
  .bar-track { flex: 1; height: 8px; background: #EEE; border-radius: 10px; overflow: hidden; }
  .bar-fill { height: 100%; background: var(--terracotta); }

  @media (min-width: 600px) { .scale-options { grid-template-columns: repeat(6, 1fr); } }
</style>
</head>
<body>

<div class="header">
  <div class="header-logo"><svg viewBox="0 0 24 24" width="18" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H7l5-8v4h4l-5 8z"/></svg></div>
  <div><div class="header-title">Invent√°rio de Esquemas</div><div class="header-subtitle">Cleo Martins - Psicoterapia Integrativa</div></div>
  <div class="progress-bar-wrap" id="pWrap" style="display:none"><div class="progress-track"><div class="progress-fill" id="pFill"></div></div></div>
</div>

<div class="container-wide">
  <div class="screen active" id="scrIntro">
    <h1 class="intro-heading">Jornada de<br><em>Autoconhecimento</em></h1>
    <div class="instructions-box">
      <h3 style="margin-bottom:10px">üìã Como responder</h3>
      <p style="font-size:14px; color:var(--gray-mid); line-height:1.6">Responda com base no que voc√™ <strong>sente emocionalmente</strong>. O teste possui 212 quest√µes divididas em m√≥dulos. Voc√™ s√≥ avan√ßar√° para o pr√≥ximo m√≥dulo ap√≥s completar a p√°gina atual.</p>
    </div>
    <div class="patient-form">
      <h3>Dados da Paciente</h3>
      <div class="form-row">
        <div class="form-group"><label>Nome Completo</label><input type="text" id="pNome" placeholder="Seu nome"></div>
        <div class="form-group"><label>Idade</label><input type="number" id="pIdade" placeholder="Ex: 48"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Data</label><input type="date" id="pData"></div>
        <div class="form-group"><label>Profiss√£o</label><input type="text" id="pProfissao" placeholder="Sua profiss√£o"></div>
      </div>
    </div>
    <button class="btn-action" onclick="startQuiz()">Iniciar Invent√°rio ‚Üí</button>
  </div>

  <div class="screen" id="scrQuest">
    <div id="qWrap"></div>
  </div>

  <div class="screen" id="scrRes">
    <div class="results-header" style="text-align:center; margin-bottom:30px">
      <h2 style="font-family:Lora; font-size:28px">Avalia√ß√£o Conclu√≠da</h2>
      <p style="color:var(--gray-mid)">Seu mapa emocional foi gerado com sucesso.</p>
    </div>
    <div class="patient-summary" id="pSumm"></div>
    <div id="dScores"></div>
    <div style="background:#F7F4EF; padding:30px; border-radius:16px; text-align:center; margin-top:30px">
      <h3>Sincronizar Prontu√°rio</h3>
      <p style="font-size:13px; margin-bottom:20px">Os dados ser√£o enviados de forma segura para o Consult√≥rio Virtual.</p>
      <button id="btnEnv" class="btn-action" style="max-width:300px" onclick="sendToSupabase()">Enviar Resultados</button>
      <button onclick="window.print()" class="btn-nav" style="margin-top:15px; display:block; width:100%; max-width:300px; margin-left:auto; margin-right:auto">üñ®Ô∏è Gerar Relat√≥rio PDF</button>
      <div id="sStat" style="margin-top:15px; font-size:13px; display:none"></div>
    </div>
  </div>
</div>

<script>
// ESCALA DE AVALIA√á√ÉO
const scaleLabels = ["","Inteiramente falsa","Em grande parte falsa","Levemente mais verdadeira","Moderadamente verdadeira","Em grande parte verdadeira","Descreve perfeitamente"];

const domains = [
  { key:"pe", name:"Desconex√£o e Rejei√ß√£o", questions:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50] },
  { key:"au", name:"Autonomia e Desempenho", questions:[51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100] },
  { key:"li", name:"Limites Prejudicados", questions:[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140] },
  { key:"oo", name:"Orienta√ß√£o para o Outro", questions:[141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180] },
  { key:"si", name:"Supervigil√¢ncia e Inibi√ß√£o", questions:[181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212] }
];

// As quest√µes completas permanecem as mesmas (212 itens)
const questionsData = [
  [1,"As pessoas n√£o conseguiram satisfazer minhas necessidades emocionais."],[2,"Eu n√£o recebi amor e aten√ß√£o."],[3,"N√£o tenho ningu√©m para me dar apoio emocional."],
  [4,"N√£o tenho ningu√©m para se importar profundamente comigo."],[5,"N√£o tive ningu√©m que quisesse passar tempo comigo."],[6,"N√£o havia pessoas para me dar seguran√ßa."],
  [7,"N√£o senti que era especial para algu√©m."],[8,"N√£o tenho ningu√©m que me compreenda."],[9,"N√£o tenho ningu√©m para me dar bons conselhos."],
  // ... (Repita as 212 quest√µes aqui conforme o seu banco de dados original)
  [212,"Sou uma pessoa m√° que merece ser castigada."]
];

const answers = {};
let currentMod = 0;

function startQuiz() {
  if(!document.getElementById('pNome').value) { alert("Por favor, identifique-se no formul√°rio."); return; }
  document.getElementById('pWrap').style.display = 'flex';
  document.getElementById('scrIntro').classList.remove('active');
  document.getElementById('scrQuest').classList.add('active');
  renderModule(0);
}

function renderModule(idx) {
  currentMod = idx;
  const mod = domains[idx];
  const wrap = document.getElementById('qWrap');
  let html = `<div class="domain-header" style="margin-bottom:30px">
    <span style="color:var(--terracotta); font-size:12px; font-weight:600; text-transform:uppercase">M√≥dulo ${idx+1} de 5</span>
    <h2 style="font-family:Lora; font-size:24px">${mod.name}</h2>
  </div>`;

  mod.questions.forEach(qNum => {
    const q = questionsData.find(x => x[0] === qNum) || [qNum, "Quest√£o Cl√≠nica " + qNum];
    const ans = answers[qNum];
    html += `<div class="question-card ${ans?'answered':''}" id="q-${qNum}">
      <div class="question-num">${ans?'‚úì':qNum}</div>
      <p class="question-text">${q[1]}</p>
      <div class="scale-options">
        ${[1,2,3,4,5,6].map(v => `
          <button class="scale-btn ${ans===v?'selected':''}" onclick="setAns(${qNum},${v},this)">
            <strong>${v}</strong>
            <span>${scaleLabels[v]}</span>
          </button>
        `).join('')}
      </div>
    </div>`;
  });

  html += `<div class="nav-row">
    ${idx>0?`<button class="btn-nav" onclick="renderModule(${idx-1})">‚Üê Voltar</button>`:`<div></div>`}
    <button class="btn-nav primary" onclick="checkMod()">${idx<4?'Pr√≥ximo Passo ‚Üí':'Gerar Resultados'}</button>
  </div>`;

  wrap.innerHTML = html;
  window.scrollTo(0,0);
  updateProgress();
}

function setAns(q, v, btn) {
  answers[q] = v;
  const card = document.getElementById('q-'+q);
  card.classList.remove('missing');
  card.classList.add('answered');
  card.querySelector('.question-num').textContent = '‚úì';
  btn.parentElement.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  updateProgress();
}

function checkMod() {
  const mod = domains[currentMod];
  const missing = mod.questions.filter(q => !answers[q]);
  if(missing.length > 0) {
    missing.forEach(q => document.getElementById('q-'+q).classList.add('missing'));
    alert(`‚ö†Ô∏è Aten√ß√£o: Faltam ${missing.length} respostas nesta p√°gina.`);
    document.getElementById('q-'+missing[0]).scrollIntoView({behavior:'smooth', block:'center'});
    return;
  }
  if(currentMod < 4) renderModule(currentMod + 1); else showRes();
}

function updateProgress() {
  const count = Object.keys(answers).length;
  document.getElementById('pFill').style.width = (count/212*100)+'%';
}

function showRes() {
  document.getElementById('scrQuest').classList.remove('active');
  document.getElementById('scrRes').classList.add('active');
  const nome = document.getElementById('pNome').value;
  const data = document.getElementById('pData').value;
  document.getElementById('pSumm').innerHTML = `
    <div><label>Paciente</label><strong>${nome}</strong></div>
    <div><label>Data</label><strong>${data}</strong></div>
  `;

  let scores = '';
  domains.forEach(d => {
    const sum = d.questions.reduce((a, q) => a + (answers[q]||0), 0);
    const avg = (sum / d.questions.length).toFixed(2);
    const pct = ((avg-1)/5*100);
    scores += `<div class="score-card">
      <div style="flex:1"><strong>${d.name}</strong></div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%"></div></div>
      <div style="font-weight:700">${avg}</div>
    </div>`;
  });
  document.getElementById('dScores').innerHTML = scores;
}

async function sendToSupabase() {
  const btn = document.getElementById('btnEnv');
  const stat = document.getElementById('sStat');
  btn.disabled = true; btn.textContent = 'Enviando...';
  stat.style.display = 'block'; stat.textContent = 'Sincronizando com o prontu√°rio...';

  const resText = domains.map(d => {
    const avg = (d.questions.reduce((a,q)=>a+answers[q],0)/d.questions.length).toFixed(2);
    return `${d.name}: ${avg}`;
  }).join(' | ');

  try {
    const resp = await fetch('https://nyelqgsqpqoasywdioxi.supabase.co/rest/v1/clientes', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': 'sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX',
        'Authorization': 'Bearer sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX'
      },
      body: JSON.stringify({
        nome_completo: document.getElementById('pNome').value,
        anotacoes: `Idade: ${document.getElementById('pIdade').value} | Profiss√£o: ${document.getElementById('pProfissao').value}`,
        origem: "Invent√°rio Online",
        resultados_teste: { resumo: resText }
      })
    });
    if(resp.ok) {
      stat.textContent = '‚úÖ Sucesso! Dados salvos no seu Consult√≥rio Virtual.';
      btn.textContent = 'Sincronizado ‚úî';
    } else throw new Error();
  } catch(e) {
    stat.textContent = '‚ùå Erro ao enviar. Tente gerar o PDF.';
    btn.disabled = false; btn.textContent = 'Tentar Novamente';
  }
}
</script>
</body>
</html>
