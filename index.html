<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Invent√°rio de Esquemas de Young</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --cream: #F7F4EF;
    --warm-white: #F7F4EF;
    --sage: #4A2F26;
    --sage-light: #7A5A50;
    --sage-dark: #321f18;
    --terracotta: #C38A6B;
    --terracotta-light: #D9AA90;
    --charcoal: #4A2F26;
    --gray-mid: #7A6560;
    --gray-light: #DDD8D0;
    --border: #E4DDD5;
    --shadow: rgba(74,47,38,0.07);
    --error-red: #A84848;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--charcoal);
    min-height: 100vh;
    font-size: 15px;
  }

  /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
  .header {
    background: #F7F4EF;
    border-bottom: 1px solid var(--border);
    padding: 18px 32px;
    display: flex;
    align-items: center;
    gap: 14px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 1px 8px var(--shadow);
  }
  .header-logo {
    width: 36px; height: 36px;
    background: var(--charcoal);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .header-logo svg { width:18px; height:18px; fill: white; }
  .header-title {
    font-family: 'Lora', serif;
    font-size: 17px;
    font-weight: 600;
    color: var(--charcoal);
    letter-spacing: 0.01em;
  }
  .header-subtitle {
    font-size: 12px;
    color: var(--gray-mid);
    font-weight: 300;
  }
  .progress-bar-wrap {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 220px;
  }
  .progress-track {
    flex:1; height: 6px;
    background: var(--gray-light);
    border-radius: 99px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: var(--sage);
    border-radius: 99px;
    transition: width 0.4s ease;
    width: 0%;
  }
  .progress-text {
    font-size: 12px;
    color: var(--gray-mid);
    font-weight: 500;
    white-space: nowrap;
  }

  /* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
  .screen { display: none; }
  .screen.active { display: block; }

  /* ‚îÄ‚îÄ‚îÄ INTRO SCREEN ‚îÄ‚îÄ‚îÄ */
  .intro-wrap {
    max-width: 720px;
    margin: 60px auto;
    padding: 0 24px;
  }
  .intro-badge {
    display: inline-block;
    background: transparent;
    color: var(--terracotta);
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0;
    border-bottom: 1px solid var(--terracotta);
    margin-bottom: 24px;
  }
  .intro-heading {
    font-family: 'Lora', serif;
    font-size: 38px;
    line-height: 1.25;
    color: var(--charcoal);
    margin-bottom: 12px;
  }
  .intro-heading em { color: var(--charcoal); font-style: italic; opacity: 0.7; }
  .intro-desc {
    color: var(--gray-mid);
    line-height: 1.7;
    font-weight: 300;
    margin-bottom: 40px;
    font-size: 15px;
  }
  .instructions-box {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 36px;
  }
  .instructions-box h3 {
    font-family: 'Lora', serif;
    font-size: 16px;
    margin-bottom: 16px;
    color: var(--charcoal);
  }
  .instructions-box p {
    color: var(--gray-mid);
    line-height: 1.75;
    font-weight: 300;
    font-size: 14px;
    margin-bottom: 20px;
  }
  .scale-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }
  .scale-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--cream);
    border-radius: 8px;
  }
  .scale-num {
    width: 26px; height: 26px;
    background: var(--charcoal);
    color: #F7F4EF;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px;
    font-weight: 500;
    flex-shrink: 0;
  }
  .scale-label { font-size: 13px; color: var(--gray-mid); font-weight: 300; }

  /* ‚îÄ‚îÄ‚îÄ PATIENT FORM ‚îÄ‚îÄ‚îÄ */
  .patient-form {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 36px;
  }
  .patient-form h3 {
    font-family: 'Lora', serif;
    font-size: 16px;
    margin-bottom: 20px;
  }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
  .form-group label {
    font-size: 12px;
    font-weight: 500;
    color: var(--gray-mid);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .form-group input {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 11px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    background: var(--cream);
    color: var(--charcoal);
    outline: none;
    transition: border-color 0.2s;
  }
  .form-group input:focus { border-color: var(--charcoal); }

  .btn-start {
    display: block;
    width: 100%;
    padding: 16px;
    background: var(--sage);
    color: #F7F4EF;
    border: none;
    border-radius: 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    letter-spacing: 0.02em;
  }
  .btn-start:hover { background: var(--sage-dark); transform: translateY(-1px); }
  .btn-start:active { transform: translateY(0); }

  /* ‚îÄ‚îÄ‚îÄ QUESTIONS SCREEN ‚îÄ‚îÄ‚îÄ */
  .questions-wrap {
    max-width: 760px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }
  .domain-header {
    margin-bottom: 32px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }
  .domain-tag {
    display: inline-block;
    font-size: 11px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--terracotta);
    margin-bottom: 8px;
  }
  .domain-name {
    font-family: 'Lora', serif;
    font-size: 22px;
    color: var(--charcoal);
  }

  /* Question card */
  .question-card {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px 28px;
    margin-bottom: 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .question-card.answered {
    border-color: #D4C8C2;
    box-shadow: 0 1px 6px var(--shadow);
  }
  .question-card.missing {
    border: 2px solid var(--error-red);
    background-color: #FFF9F9;
  }
  .question-header {
    display: flex;
    gap: 14px;
    align-items: flex-start;
    margin-bottom: 18px;
  }
  .question-num {
    flex-shrink: 0;
    width: 28px; height: 28px;
    border: 1.5px solid var(--gray-light);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px;
    font-weight: 500;
    color: var(--gray-mid);
    margin-top: 1px;
  }
  .question-card.answered .question-num {
    background: var(--terracotta);
    border-color: var(--terracotta);
    color: #F7F4EF;
  }
  .question-text {
    font-size: 15px;
    line-height: 1.6;
    color: var(--charcoal);
    font-weight: 400;
  }
  .scale-options {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .scale-btn {
    flex: 1;
    min-width: 40px;
    padding: 9px 4px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    background: var(--cream);
    cursor: pointer;
    text-align: center;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    color: var(--gray-mid);
    transition: all 0.15s;
    user-select: none;
  }
  .scale-btn:hover { border-color: var(--terracotta); color: var(--charcoal); background: #F0EBE6; }
  .scale-btn.selected {
    background: var(--sage);
    border-color: var(--sage);
    color: #F7F4EF;
  }
  .scale-btn .btn-label {
    display: block;
    font-size: 10px;
    font-weight: 300;
    margin-top: 2px;
    opacity: 0.8;
    line-height: 1.3;
  }

  /* Navigation between domains */
  .nav-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    gap: 16px;
  }
  .btn-nav {
    padding: 13px 28px;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border: 1.5px solid var(--border);
    background: var(--warm-white);
    color: var(--gray-mid);
  }
  .btn-nav:hover { border-color: var(--charcoal); color: var(--charcoal); }
  .btn-nav.primary {
    background: var(--sage);
    border-color: var(--sage);
    color: #F7F4EF;
  }
  .btn-nav.primary:hover { background: var(--sage-dark); border-color: var(--sage-dark); }
  .nav-domain-info {
    font-size: 13px;
    color: var(--gray-mid);
    text-align: center;
  }

  /* ‚îÄ‚îÄ‚îÄ RESULTS SCREEN ‚îÄ‚îÄ‚îÄ */
  .results-wrap {
    max-width: 760px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }
  .results-header {
    text-align: center;
    margin-bottom: 48px;
  }
  .results-header .check-icon {
    width: 56px; height: 56px;
    background: var(--sage);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 20px;
  }
  .results-header .check-icon svg { width:26px; height:26px; stroke: white; fill:none; stroke-width:2.5; }
  .results-header h2 {
    font-family: 'Lora', serif;
    font-size: 30px;
    margin-bottom: 8px;
  }
  .results-header p {
    color: var(--gray-mid);
    font-weight: 300;
    font-size: 14px;
  }
  .patient-summary {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px 24px;
    margin-bottom: 32px;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .patient-summary .info-item label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--gray-mid);
    display: block;
    margin-bottom: 2px;
  }
  .patient-summary .info-item span {
    font-size: 15px;
    font-weight: 500;
    color: var(--charcoal);
  }
  .domain-scores-title {
    font-family: 'Lora', serif;
    font-size: 20px;
    margin-bottom: 20px;
  }
  .domain-score-card {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px 24px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .domain-score-name {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
    color: var(--charcoal);
  }
  .domain-score-name small {
    display: block;
    font-size: 12px;
    font-weight: 300;
    color: var(--gray-mid);
    margin-top: 2px;
  }
  .domain-bar-wrap {
    flex: 2;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .domain-bar-track {
    flex: 1;
    height: 8px;
    background: var(--gray-light);
    border-radius: 99px;
    overflow: hidden;
  }
  .domain-bar-fill {
    height: 100%;
    border-radius: 99px;
    transition: width 0.8s cubic-bezier(0.23, 1, 0.32, 1);
  }
  .domain-score-val {
    font-size: 14px;
    font-weight: 600;
    color: var(--charcoal);
    min-width: 48px;
    text-align: right;
  }

  .score-low .domain-bar-fill { background: #C7B8B4; }
  .score-mid .domain-bar-fill { background: var(--terracotta-light); }
  .score-high .domain-bar-fill { background: var(--terracotta); }

  .send-section {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    margin-top: 32px;
    text-align: center;
  }
  .send-section h3 {
    font-family: 'Lora', serif;
    font-size: 17px;
    margin-bottom: 8px;
  }
  .send-section p {
    font-size: 13px;
    color: var(--gray-mid);
    margin-bottom: 20px;
    font-weight: 300;
    line-height: 1.6;
  }
  .btn-send {
    padding: 11px 24px;
    background: var(--sage);
    color: #F7F4EF;
    border: none;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    white-space: nowrap;
  }
  .btn-send:hover { background: var(--sage-dark); }
  .send-status {
    margin-top: 12px;
    font-size: 13px;
    padding: 10px 14px;
    border-radius: 8px;
    display: none;
  }

  .btn-print {
    display: block;
    width: 100%;
    margin-top: 16px;
    padding: 13px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    background: var(--warm-white);
    color: var(--gray-mid);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }
  .btn-print:hover { border-color: var(--charcoal); color: var(--charcoal); }

  /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
  @media (max-width: 600px) {
    .form-row { grid-template-columns: 1fr; }
    .scale-grid { grid-template-columns: 1fr; }
    .intro-heading { font-size: 28px; }
    .header { padding: 14px 16px; }
    .progress-bar-wrap { min-width: 120px; }
    .domain-bar-wrap { flex-direction: column; align-items: flex-start; gap: 6px; }
    .domain-score-card { flex-wrap: wrap; }
    .scale-btn .btn-label { display: none; }
  }

  @media print {
    .header, .nav-row, .send-section, .btn-print { display: none !important; }
    .results-wrap { padding: 0; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-logo">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H7l5-8v4h4l-5 8z"/></svg>
  </div>
  <div>
    <div class="header-title">Invent√°rio de Esquemas de Young</div>
    <div class="header-subtitle">Question√°rio cl√≠nico ‚Äî Cleo Martins</div>
  </div>
  <div class="progress-bar-wrap" id="progressWrap" style="display:none">
    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-text" id="progressText">0 / 212</div>
  </div>
</div>

<div class="screen active" id="screenIntro">
<div class="intro-wrap">
  <div class="intro-badge">Psicoterapia Cl√≠nica</div>
  <h1 class="intro-heading">Question√°rio de<br><em>Invent√°rio de Esquemas</em></h1>
  <p class="intro-desc">
    Este question√°rio √© uma ferramenta de avalia√ß√£o cl√≠nica. Suas respostas s√£o confidenciais 
    e ser√£o utilizadas pela sua terapeuta para compreender melhor seus padr√µes emocionais e cognitivos.
  </p>

  <div class="instructions-box">
    <h3>üìã Instru√ß√µes</h3>
    <p>
      S√£o listadas abaixo afirma√ß√µes que uma pessoa poderia usar para se descrever. 
      Por favor, leia cada afirma√ß√£o e decida qu√£o bem ela descreve voc√™. 
      <strong>Quando n√£o tiver certeza, baseie sua resposta no que voc√™ sente emocionalmente</strong>, 
      n√£o no que pensa ser verdade. Escolha a avalia√ß√£o de 1 a 6 que melhor o descreve.
    </p>
    <div class="scale-grid">
      <div class="scale-item"><div class="scale-num">1</div><div class="scale-label">Inteiramente falsa</div></div>
      <div class="scale-item"><div class="scale-num">2</div><div class="scale-label">Em grande parte falsa</div></div>
      <div class="scale-item"><div class="scale-num">3</div><div class="scale-label">Levemente mais verdadeira do que falsa</div></div>
      <div class="scale-item"><div class="scale-num">4</div><div class="scale-label">Moderadamente verdadeira</div></div>
      <div class="scale-item"><div class="scale-num">5</div><div class="scale-label">Em grande parte verdadeira</div></div>
      <div class="scale-item"><div class="scale-num">6</div><div class="scale-label">Descreve-me perfeitamente</div></div>
    </div>
  </div>

  <div class="patient-form">
    <h3>Seus dados</h3>
    <div class="form-row">
      <div class="form-group">
        <label>Nome completo</label>
        <input type="text" id="pNome" placeholder="Seu nome"/>
      </div>
      <div class="form-group">
        <label>Idade</label>
        <input type="number" id="pIdade" placeholder="Ex: 34"/>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Data de hoje</label>
        <input type="date" id="pData"/>
      </div>
      <div class="form-group">
        <label>Profiss√£o</label>
        <input type="text" id="pProfissao" placeholder="Sua profiss√£o"/>
      </div>
    </div>
  </div>

  <button class="btn-start" onclick="startQuiz()">Iniciar question√°rio ‚Üí</button>
</div>
</div>

<div class="screen" id="screenQuestions">
<div class="questions-wrap" id="questionsWrap">
  </div>
</div>

<div class="screen" id="screenResults">
<div class="results-wrap">
  <div class="results-header">
    <div class="check-icon">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
    </div>
    <h2>Question√°rio conclu√≠do</h2>
    <p>Abaixo est√£o as pontua√ß√µes calculadas por dom√≠nio de esquema</p>
  </div>

  <div class="patient-summary" id="patientSummary"></div>

  <h3 class="domain-scores-title">Pontua√ß√£o por dom√≠nio</h3>
  <div id="domainScores"></div>

  <div class="send-section">
    <h3 style="color: #4A2F26; font-family: 'Lora', serif; font-size: 20px; margin-bottom: 10px;">Finalizar e Enviar</h3>
    <p style="color: #6B4A42; font-size: 15px; margin-bottom: 25px;">Seus dados est√£o protegidos por sigilo terap√™utico. Clique abaixo para enviar seus resultados diretamente para o prontu√°rio.</p>
    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button id="btn-enviar" onclick="sendToSupabase()" class="btn-send">Enviar Resultados</button>
        <button onclick="window.print()" class="btn-print" style="margin-top: 0; width: auto; background-color: transparent;">üñ®Ô∏è Salvar como PDF</button>
    </div>
    <div id="sendStatus" class="send-status"></div>
  </div>
</div>
</div>

<script>
const scaleLabels = ["","Inteiramente falsa","Em grande parte falsa","Levemente mais verdadeira","Moderadamente verdadeira","Em grande parte verdadeira","Descreve perfeitamente"];

// Os 18 dom√≠nios originais para o c√°lculo do resultado final
const domains = [
  { key:"pe", name:"Priva√ß√£o Emocional", questions:[1,2,3,4,5,6,7,8,9] },
  { key:"ab", name:"Abandono / Instabilidade", questions:[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27] },
  { key:"da", name:"Desconfian√ßa / Abuso", questions:[28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44] },
  { key:"ia", name:"Isolamento Social / Aliena√ß√£o", questions:[45,46,47,48,49,50,51,52,53,54] },
  { key:"dv", name:"Defectividade / Vergonha", questions:[55,56,57,58,59,60,61,62,63,64,65,66,67,68,69] },
  { key:"np", name:"Negatividade / Pessimismo", questions:[70,71,72,73,74,75] },
  { key:"fr", name:"Fracasso", questions:[76,77,78,79,80,81,82,83,84] },
  { key:"di", name:"Depend√™ncia / Incompet√™ncia", questions:[85,86,87,88,89,90,91,92,93,94,95,96,97,98,99] },
  { key:"vd", name:"Vulnerabilidade ao Dano", questions:[100,101,102,103,104,105,106,107,108,109,110,111,112,113] },
  { key:"em", name:"Emaranhamento / Self Subdesenvolvido", questions:[114,115,116,117,118,119,120,121,122,123,124] },
  { key:"sb", name:"Subjuga√ß√£o", questions:[125,126,127,128,129,130,131,132,133,134] },
  { key:"as", name:"Autossacrif√≠cio", questions:[135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151] },
  { key:"ie", name:"Inibi√ß√£o Emocional", questions:[152,153,154,155,156,157,158,159,160] },
  { key:"pi", name:"Padr√µes Inflex√≠veis / Hipercriticismo", questions:[161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176] },
  { key:"me", name:"Grandiosidade / Merecimento", questions:[177,178,179,180,181,182,183,184,185,186,187] },
  { key:"ai", name:"Autocontrole Insuficiente", questions:[188,189,190,191,192,193,194,195,196,197,198,199,200,201,202] },
  { key:"ba", name:"Busca de Aprova√ß√£o / Busca de Reconhecimento", questions:[203,204,205,206,207] },
  { key:"pp", name:"Autopuni√ß√£o / Puni√ß√£o", questions:[208,209,210,211,212] },
];

// As 5 p√°ginas (m√≥dulos) para navega√ß√£o com freio
const pageModules = [
  { title: "Parte 1", name: "Desconex√£o e Rejei√ß√£o", questions: Array.from({length: 50}, (_, i) => i + 1) },
  { title: "Parte 2", name: "Autonomia e Desempenho", questions: Array.from({length: 50}, (_, i) => i + 51) },
  { title: "Parte 3", name: "Limites Prejudicados", questions: Array.from({length: 40}, (_, i) => i + 101) },
  { title: "Parte 4", name: "Orienta√ß√£o para o Outro", questions: Array.from({length: 40}, (_, i) => i + 141) },
  { title: "Parte 5", name: "Supervigil√¢ncia e Inibi√ß√£o", questions: Array.from({length: 32}, (_, i) => i + 181) }
];

const allQuestions = [
  [1,"As pessoas n√£o conseguiram satisfazer minhas necessidades emocionais."],
  [2,"Eu n√£o recebi amor e aten√ß√£o."],
  [3,"De um modo geral, n√£o tenho ningu√©m para me dar conselhos e apoio emocional."],
  [4,"A maior parte do tempo, n√£o tenho ningu√©m para me dar carinho, compartilhar comigo e se importar profundamente com o que me acontece."],
  [5,"Eu n√£o tive ningu√©m que quisesse se aproximar e passar bastante tempo comigo em grande parte da minha vida."],
  [6,"Em geral, n√£o havia pessoas para me dar carinho, seguran√ßa e afei√ß√£o."],
  [7,"Eu n√£o senti que era especial para algu√©m, em grande parte da minha vida."],
  [8,"Em geral, n√£o tenho ningu√©m que realmente me escute, me compreenda ou esteja sintonizado com minhas verdadeiras necessidades e sentimentos."],
  [9,"Eu, raramente tenho alguma pessoa forte para me dar bons conselhos ou orienta√ß√£o quando n√£o tenho certeza do que fazer."],
  [10,"Eu me preocupo com a possibilidade de as pessoas que eu amo morrerem, mesmo que haja poucas raz√µes m√©dicas para confirmar minhas preocupa√ß√µes."],
  [11,"Percebo que me agarro √†s pessoas com as quais tenho intimidade, por ter medo de que elas me deixem."],
  [12,"Eu me preocupo com a possibilidade das pessoas que gosto me deixarem ou me abandonarem."],
  [13,"Sinto que me falta uma base est√°vel de apoio emocional."],
  [14,"N√£o espero que os relacionamentos importantes durem; acredito que eles v√£o terminar."],
  [15,"Sinto que me apego a parceiros/as que n√£o s√£o capazes de se comprometerem comigo."],
  [16,"No final, acabarei s√≥."],
  [17,"Quando sinto que algu√©m com quem eu me importo est√° se afastando, fico desesperado."],
  [18,"√Äs vezes, tenho tanto medo de que as pessoas me deixem que acabo fazendo com que se afastem."],
  [19,"Fico incomodado quando algu√©m me deixa sozinho, mesmo que por pouco tempo."],
  [20,"N√£o posso esperar que as pessoas que me ap√≥iam estejam sempre dispon√≠veis."],
  [21,"N√£o devo ficar realmente √≠ntimo das pessoas, porque n√£o posso ter certeza de que poderei contar sempre com elas."],
  [22,"Parece que as pessoas importantes da minha vida est√£o sempre indo e vindo."],
  [23,"Tenho muito medo de que as pessoas que eu amo encontrem algu√©m que v√£o preferir e me deixem."],
  [24,"As pessoas que me s√£o pr√≥ximas t√™m sido muito imprevis√≠veis; ora s√£o legais, ora est√£o zangadas, chateadas, absorvidas em si mesmas, brigando, e assim por diante."],
  [25,"Preciso tanto das pessoas que tenho medo de perd√™-las."],
  [26,"Eu me sinto indefeso se n√£o tiver pessoas para me proteger, √†s quais eu me preocupo muito em perd√™-las."],
  [27,"N√£o posso ser eu mesmo ou expressar o que realmente sinto, pois as pessoas me deixariam."],
  [28,"Sinto que as pessoas querem tirar vantagem de mim."],
  [29,"Frequentemente, sinto que tenho que me proteger dos outros."],
  [30,"Sinto que n√£o posso baixar a guarda na presen√ßa dos outros, pois eles me prejudicariam intencionalmente."],
  [31,"Se uma pessoa √© legal comigo, fico imaginando que ela est√° querendo alguma coisa."],
  [32,"√â s√≥ uma quest√£o de tempo antes que as pessoas me traiam."],
  [33,"A maioria das pessoas s√≥ pensa em si mesma."],
  [34,"Tenho grande dificuldade em confiar nas pessoas."],
  [35,"Desconfio muito dos motivos dos outros."],
  [36,"As outras pessoas raramente s√£o honestas; elas geralmente n√£o s√£o o que parecem."],
  [37,"Eu geralmente fico procurando os motivos escondidos das pessoas."],
  [38,"Se acho que algu√©m quer me prejudicar, tento prejudic√°-la/o primeiro."],
  [39,"As pessoas t√™m de provar coisas para mim antes que eu confie nelas."],
  [40,"Invento 'testes' para as pessoas para ver se elas est√£o me dizendo a verdade e se est√£o bem intencionadas."],
  [41,"Acredito no ditado: 'quem n√£o controla √© controlado'."],
  [42,"Fico com raiva quando penso como fui maltratado pelas pessoas durante toda a minha vida."],
  [43,"Por toda a minha vida, pessoas que me eram pr√≥ximas tiraram vantagem de mim ou me usaram para seus prop√≥sitos."],
  [44,"Fui abusado fisicamente, emocionalmente ou sexualmente por pessoas importantes na minha vida."],
  [45,"Eu n√£o me encaixo."],
  [46,"Sou fundamentalmente diferente das outras pessoas."],
  [47,"Eu n√£o perten√ßo a ningu√©m; sou um solit√°rio."],
  [48,"Sinto-me alienado das outras pessoas."],
  [49,"Eu me sinto isolado e sozinho."],
  [50,"Sempre me sinto exclu√≠da dos grupos."],
  [51,"Ningu√©m me entende realmente."],
  [52,"A minha fam√≠lia sempre foi diferente das fam√≠lias que nos cercavam."],
  [53,"√Äs vezes, me sinto um alien√≠gena."],
  [54,"Se eu desaparecesse amanh√£, ningu√©m perceberia."],
  [55,"Nenhum/a homem/mulher que eu desejar vai me amar depois de saber dos meus defeitos."],
  [56,"Ningu√©m que eu desejar vai querer ficar perto de mim depois que conhecer meu verdadeiro eu."],
  [57,"Sou inerentemente defeituoso e cheio de falhas."],
  [58,"Por mais que eu tente, sinto que n√£o conseguirei que um/a homem/mulher significativo/a me respeite ou sinta que eu tenho valor."],
  [59,"N√£o sou digno do amor, da aten√ß√£o e do respeito dos outros."],
  [60,"Sinto que n√£o mere√ßo ser amado."],
  [61,"Sou inaceit√°vel demais, de todas as maneiras poss√≠veis, para me revelar aos outros."],
  [62,"Se as pessoas descobrissem meus defeitos b√°sicos, eu n√£o conseguiria encar√°-las."],
  [63,"Quando as pessoas gostam de mim, sinto que as estou enganando."],
  [64,"Frequentemente, sou atra√≠do por pessoas que s√£o muito cr√≠ticas ou me rejeitam."],
  [65,"Tenho segredos que eu n√£o quero que as pessoas pr√≥ximas a mim descubram."],
  [66,"Foi por minha culpa que meus pais n√£o conseguiram me amar o suficiente."],
  [67,"N√£o deixo que as pessoas conhe√ßam meu verdadeiro eu."],
  [68,"Um dos meus maiores medos √© que meus defeitos sejam expostos."],
  [69,"N√£o posso compreender como ningu√©m conseguiu me amar."],
  [70,"Mesmo quando as coisas parecem estar indo bem, sinto que isto √© apenas tempor√°rio."],
  [71,"Se algo de bom acontecer, fico preocupado(a) se algo de ruim n√£o vai acontecer em seguida."],
  [72,"Todo cuidado √© pouco; quase sempre alguma coisa vai mal."],
  [73,"Por mais que trabalhe, fico preocupado(a) com a possibilidade de ficar na mis√©ria e perder quase tudo que possuo."],
  [74,"As pessoas que valorizo n√£o iriam querer se associar a mim devido ao meu status social (por exemplo, renda, n√≠vel de instru√ß√£o, profiss√£o)."],
  [75,"Fico preocupado(a) com a possibilidade de uma decis√£o errada provocar uma cat√°strofe."],
  [76,"Quase nada do que eu fa√ßo no trabalho (ou na escola) √© t√£o bom quanto o que os outros fazem."],
  [77,"Sou incompetente no que se refere √†s realiza√ß√µes."],
  [78,"A maioria das pessoas √© mais capaz do que eu no trabalho e em suas realiza√ß√µes."],
  [79,"Eu sou um fracasso."],
  [80,"N√£o tenho tanto talento quanto a maioria das pessoas tem em sua profiss√£o."],
  [81,"N√£o sou t√£o inteligente quanto a maioria das pessoas no que se refere a trabalho (ou estudo)."],
  [82,"Sinto-me humilhado por meus fracassos e inadequa√ß√µes na esfera do trabalho."],
  [83,"Frequentemente me sinto embara√ßado perto das pessoas porque n√£o estou √† altura delas em termos de realiza√ß√£o."],
  [84,"Muitas vezes comparo minhas realiza√ß√µes com as dos outros e acho que eles s√£o muito mais bem-sucedidos."],
  [85,"N√£o me sinto capaz de me arranjar sozinho no dia-a-dia."],
  [86,"Preciso que as outras pessoas me ajudem a fazer as coisas."],
  [87,"N√£o me sinto capaz de manejar bem as situa√ß√µes sem ajuda."],
  [88,"Acredito que as pessoas podem cuidar melhor de mim melhor do que eu mesmo."],
  [89,"Tenho dificuldade em lidar com tarefas novas fora do trabalho, a menos que tenha algu√©m para me orientar."],
  [90,"Penso em mim como uma pessoa dependente, no que se refere ao funcionamento cotidiano."],
  [91,"Acabo estragando tudo o que tento fazer, mesmo fora do trabalho (ou da escola)."],
  [92,"Sou incapaz em quase todas as √°reas da vida."],
  [93,"Se eu confiar no meu pr√≥prio julgamento nas situa√ß√µes do dia-a-dia, tomarei a decis√£o errada."],
  [94,"Falta-me bom senso."],
  [95,"N√£o se pode confiar em meu julgamento nas situa√ß√µes do dia-a-dia."],
  [96,"N√£o confio em minha capacidade de resolver os problemas que surgem no cotidiano."],
  [97,"Sinto que preciso de algu√©m em quem eu possa confiar para me dar conselhos sobre quest√µes pr√°ticas."],
  [98,"Sinto-me mais como uma crian√ßa do que como uma pessoa adulta quando √© preciso assumir responsabilidades do cotidiano."],
  [99,"Acho as responsabilidades do dia-a-dia esmagadoras."],
  [100,"N√£o consigo deixar de sentir que algo de ruim vai acontecer."],
  [101,"Sinto que algum desastre (natural, criminal, financeiro ou m√©dico) vai acontecer a qualquer momento."],
  [102,"Tenho medo de me tornar um 'sem-teto' ou um abandonado √† pr√≥pria sorte."],
  [103,"Tenho medo de ser atacado."],
  [104,"Sinto que devo ter muito cuidado com dinheiro, ou acabarei sem nada."],
  [105,"Tomo muitas precau√ß√µes para n√£o adoecer e n√£o me machucar."],
  [106,"Tenho medo de perder todo o meu dinheiro e ficar pobre."],
  [107,"Tenho medo de pegar uma doen√ßa s√©ria, mesmo que nada de s√©rio tenha sido diagnosticado pelos m√©dicos."],
  [108,"Sou uma pessoa medrosa."],
  [109,"Eu me preocupo muito com todas as coisas horr√≠veis que acontecem no mundo: crime, polui√ß√£o, e assim por diante."],
  [110,"Muitas vezes, acho que posso enlouquecer."],
  [111,"Sinto, frequentemente, que vou ter um ataque de ansiedade."],
  [112,"Tenho muito medo de ter um ataque card√≠aco, embora haja poucas raz√µes m√©dicas que justifiquem minha preocupa√ß√£o."],
  [113,"Acho que o mundo √© um lugar perigoso."],
  [114,"N√£o consegui me separar de meu pai/minha m√£e, ou de ambos, assim como outras pessoas da minha idade parecem conseguir."],
  [115,"Meu pai/minha m√£e, ou ambos, e eu, tendemos a nos envolver excessivamente com a vida e com os problemas uns dos outros."],
  [116,"√â muito dif√≠cil para meu pai/minha m√£e, ou ambos, e eu, escondermos detalhes √≠ntimos uns dos outros sem nos sentirmos tra√≠dos ou culpados."],
  [117,"Meu pai/minha m√£e, ou ambos, e eu, temos que nos falar quase todos os dias, ou um de n√≥s se sente culpado, magoado, desapontado ou sozinho."],
  [118,"Muitas vezes, sinto que n√£o tenho uma identidade separada da de meus pais ou parceiro/a."],
  [119,"Muitas vezes me parece que meus pais est√£o vivendo por interm√©dio de mim - eu n√£o tenho uma vida pr√≥pria."],
  [120,"√â muito dif√≠cil para eu manter alguma dist√¢ncia das pessoas de quem sou √≠ntimo; n√£o √© f√°cil para eu ter um senso separado de mim mesmo."],
  [121,"Estou t√£o envolvido com meu/minha parceiro/a ou com meus pais que n√£o sei realmente quem sou, ou o que quero."],
  [122,"Tenho dificuldade em separar meu ponto de vista, ou dos meus pais ou parceiro/a."],
  [123,"Sinto que n√£o tenho nenhuma privacidade no que se refere aos meus pais ou parceiro/a."],
  [124,"Sinto que meus pais est√£o, ou ficaram, muito magoados por eu morar sozinho, longe deles."],
  [125,"Deixo as pessoas fazerem o que querem porque tenho medo das conseq√º√™ncias."],
  [126,"Acho que se eu fizer o que quero, s√≥ vou arranjar problemas."],
  [127,"Sinto que n√£o tenho escolhas al√©m de ceder ao desejo das pessoas, ou elas v√£o me rejeitar ou retaliar de alguma forma."],
  [128,"Nos meus relacionamentos, deixo a outra pessoa ter o controle."],
  [129,"Sempre deixei os outros escolherem por mim, de modo que n√£o sei realmente o que quero."],
  [130,"Sinto que as maiores decis√µes da minha vida n√£o foram realmente minhas."],
  [131,"Eu me preocupo muito em agradar os outros para que eles n√£o me rejeitem."],
  [132,"Tenho muita dificuldade em exigir que meus direitos sejam respeitados e que meus sentimentos sejam levados em conta."],
  [133,"Eu me vingo das pessoas de maneira sutil, em vez de demonstrar minha raiva."],
  [134,"Vou muito al√©m do que a maioria das pessoas para evitar confronta√ß√µes."],
  [135,"Coloco as necessidades dos outros antes das minhas, ou me sinto culpado."],
  [136,"Sinto culpa quando desaponto as pessoas."],
  [137,"Dou mais √†s pessoas do que recebo delas."],
  [138,"Sou aquele que geralmente acaba cuidando das pessoas de quem sou pr√≥ximo."],
  [139,"N√£o h√° nada que n√£o possa aceitar quando amo algu√©m."],
  [140,"Sou uma boa pessoa, pois penso nos outros mais do que em mim mesmo."],
  [141,"No trabalho, normalmente sou aquele que se apresenta como volunt√°rio para fazer as tarefas extras, ou trabalhar mais tempo."],
  [142,"Por mais ocupado que esteja, eu sempre arranjo tempo para os outros."],
  [143,"Consigo me virar com muito pouco, porque as minhas necessidades s√£o m√≠nimas."],
  [144,"S√≥ me sinto feliz quando aqueles que me cercam est√£o felizes."],
  [145,"Fico t√£o ocupado fazendo coisas para as pessoas que gosto que tenho pouco tempo para mim."],
  [146,"Sempre fui aquele que escuta os problemas de todo mundo."],
  [147,"Fico mais √† vontade dando um presente do que recebendo."],
  [148,"As pessoas me v√™em fazendo mais pelos outros e pouco por mim."],
  [149,"Por mais que eu d√™, nunca √© suficiente."],
  [150,"Se fa√ßo o que quero, me sinto muito mal."],
  [151,"√â muito dif√≠cil para eu pedir aos outros que atendam √†s minhas necessidades."],
  [152,"Tenho medo de perder o controle das minhas a√ß√µes."],
  [153,"Tenho medo de machucar muito as pessoas, f√≠sica ou emocionalmente, caso perca o controle da minha raiva."],
  [154,"Sinto que preciso controlar as minhas emo√ß√µes e impulsos, ou algo de ruim pode acontecer."],
  [155,"Dentro de mim h√° muita raiva e ressentimentos que n√£o expresso."],
  [156,"Tenho muita vergonha de demonstrar sentimentos positivos em rela√ß√£o aos outros (por exemplo: afei√ß√£o, sinais de cuidado)."],
  [157,"Acho embara√ßoso expressar meus sentimentos para os outros."],
  [158,"Tenho dificuldade em ser carinhoso e espont√¢neo."],
  [159,"Eu me controlo tanto que as pessoas acham que eu n√£o sou emotivo/afetivo."],
  [160,"As pessoas me v√™em como emocionalmente contida."],
  [161,"Preciso ser o melhor em tudo que fa√ßo; n√£o consigo aceitar vir em segundo lugar."],
  [162,"Tento manter tudo dentro da mais perfeita ordem."],
  [163,"Preciso causar a melhor impress√£o, praticamente, o tempo todo."],
  [164,"Tento fazer o melhor, n√£o consigo aceitar o 'suficientemente bom'."],
  [165,"Tenho tantas coisas para fazer que quase n√£o me sobra tempo para relaxar de verdade."],
  [166,"Quase nada √© bom o bastante; sempre posso fazer melhor."],
  [167,"Preciso cumprir todas as minhas responsabilidades."],
  [168,"Sinto que existe uma press√£o constante sobre mim para conquistar e fazer as coisas."],
  [169,"Meus relacionamentos s√£o prejudicados porque exijo demais de mim."],
  [170,"Minha sa√∫de sofre porque me pressiono demais para sair bem."],
  [171,"Muitas vezes sacrifico prazer e felicidade para estar √† altura dos meus padr√µes."],
  [172,"Se cometo um erro, mere√ßo ser muito criticado."],
  [173,"N√£o consigo me soltar ou me desculpar por meus erros com facilidade."],
  [174,"Sou uma pessoa muito competitiva."],
  [175,"Dou muito valor a dinheiro e status."],
  [176,"Tenho que ser sempre o 'N√∫mero 1' em termos de desempenho."],
  [177,"Tenho muita dificuldade em aceitar um 'n√£o' como resposta quando quero alguma coisa de algu√©m."],
  [178,"Geralmente me zango, ou me irrito, quando n√£o consigo aquilo que quero."],
  [179,"Sou especial e n√£o deveria ter que aceitar muitas das restri√ß√µes impostas √†s outras pessoas."],
  [180,"Detesto ser obrigado a fazer alguma coisa, ou impedido de fazer o que quero."],
  [181,"Acho que n√£o deveria ter que obedecer √†s regras e conven√ß√µes normais assim como os outros."],
  [182,"Sinto que aquilo que tenho a oferecer √© muito mais valioso do que as contribui√ß√µes dos outros."],
  [183,"Geralmente coloco as minhas necessidades acima das necessidades dos outros."],
  [184,"Muitas vezes sinto que estou t√£o envolvido com as minhas prioridades que n√£o tenho tempo para os amigos ou a fam√≠lia."],
  [185,"As pessoas frequentemente me dizem que sou muito controlador em rela√ß√£o a como as coisas devem ser feitas."],
  [186,"Fico muito irritado quando as pessoas n√£o fazem o que eu lhes pe√ßo."],
  [187,"N√£o tolero que as pessoas me digam o que fazer."],
  [188,"Tenho grande dificuldade para deixar de beber, fumar, comer demais e modificar outros comportamentos problem√°ticos."],
  [189,"Parece que n√£o consigo me disciplinar e levar at√© o fim as tarefas rotineiras ou chatas."],
  [190,"Muitas vezes, me permito obedecer impulsos e expressar emo√ß√µes que me trazem problemas ou machucam as pessoas."],
  [191,"Quando n√£o consigo atingir algum objetivo, fico facilmente frustrado e desisto."],
  [192,"Para mim, √© muito dif√≠cil sacrificar uma gratifica√ß√£o imediata para atingir um objetivo a longo prazo."],
  [193,"Depois que come√ßo a sentir raiva, √© comum n√£o conseguir control√°-la."],
  [194,"Tendendo a fazer muitas coisas em excesso, mesmo sabendo que isso n√£o √© bom para mim."],
  [195,"Eu me aborre√ßo muito facilmente."],
  [196,"Quando as tarefas ficam dif√≠ceis, geralmente n√£o consigo perseverar e conclu√≠-las."],
  [197,"N√£o consigo me concentrar em nada por muito tempo."],
  [198,"N√£o consigo me obrigar a fazer coisas de que n√£o gosto, mesmo sabendo que √© para o meu pr√≥prio bem."],
  [199,"Perco a calma diante da ofensa mais insignificante."],
  [200,"Raramente consigo cumprir minhas resolu√ß√µes."],
  [201,"Quase nunca deixo de mostrar √†s pessoas o que realmente sinto, seja qual for o custo disso."],
  [202,"Frequentemente fa√ßo, por impulso, coisas que mais tarde lamento."],
  [203,"Ter dinheiro e conhecer pessoas importantes me faz sentir uma pessoa de valor."],
  [204,"Aquilo que consigo alcan√ßar tem mais valor para mim se for algo em que os outros reparem."],
  [205,"Sinto-me pouco importante, a n√£o ser que receba muita aten√ß√£o dos outros."],
  [206,"Quando fa√ßo uma interven√ß√£o em uma reuni√£o ou quando sou apresentado a algu√©m em um grupo, para mim √© importante obter reconhecimento e admira√ß√£o."],
  [207,"Receber muitos elogios dos outros me faz sentir como uma pessoa que tem valor."],
  [208,"Se cometer um erro mere√ßo ser castigado."],
  [209,"Se n√£o me esfor√ßar ao m√°ximo √© de esperar que as coisas corram mal."],
  [210,"Se n√£o fizer bem o que me compete mere√ßo sofrer as consequ√™ncias."],
  [211,"N√£o interessa o motivo pelo qual cometi um erro; quando fa√ßo algo errado √© preciso arcar com as consequ√™ncias."],
  [212,"Sou uma pessoa m√° que merece ser castigada."]
];

const answers = {};
let currentModIdx = 0;

function updateProgress() {
  const answered = Object.keys(answers).length;
  const pct = (answered / 212) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = answered + ' / 212';
}

function startQuiz() {
  if(!document.getElementById('pNome').value) { alert("Por favor, insira o seu nome antes de come√ßar."); return; }
  
  const dateInput = document.getElementById('pData');
  if (!dateInput.value) dateInput.value = new Date().toISOString().split('T')[0];

  document.getElementById('progressWrap').style.display = 'flex';
  showScreen('screenQuestions');
  renderModule(0);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function renderModule(idx) {
  currentModIdx = idx;
  const mod = pageModules[idx];
  const wrap = document.getElementById('questionsWrap');

  // Mantendo o SEU HTML exato do domain-header
  let html = `
    <div class="domain-header">
      <div class="domain-tag">M√≥dulo ${idx + 1} de ${pageModules.length}</div>
      <div class="domain-name">${mod.name}</div>
    </div>
  `;

  mod.questions.forEach(qNum => {
    const qData = allQuestions.find(q => q[0] === qNum) || [qNum, "Quest√£o " + qNum];
    const ans = answers[qNum];
    
    // Mantendo o SEU HTML exato do question-card e scale-options
    html += `
      <div class="question-card ${ans ? 'answered' : ''}" id="qcard-${qNum}">
        <div class="question-header">
          <div class="question-num">${ans ? '‚úì' : qNum}</div>
          <div class="question-text">${qData[1]}</div>
        </div>
        <div class="scale-options">
          ${[1,2,3,4,5,6].map(v => `
            <button class="scale-btn ${ans === v ? 'selected' : ''}" 
              onclick="selectAnswer(${qNum}, ${v}, this)">
              ${v}
              <span class="btn-label">${scaleLabels[v]}</span>
            </button>
          `).join('')}
        </div>
      </div>
    `;
  });

  // Mantendo o SEU HTML exato da nav-row
  html += `
    <div class="nav-row">
      ${idx > 0 
        ? `<button class="btn-nav" onclick="renderModule(${idx - 1})">‚Üê Anterior</button>`
        : `<div></div>`
      }
      <div class="nav-domain-info">
        Respondendo Parte ${idx + 1}
      </div>
      <button class="btn-nav primary" onclick="checkAndAdvance()">
        ${idx < pageModules.length - 1 ? 'Pr√≥ximo ‚Üí' : 'Ver resultados ‚Üí'}
      </button>
    </div>
  `;

  wrap.innerHTML = html;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function selectAnswer(qNum, val, btn) {
  answers[qNum] = val;
  const card = document.getElementById('qcard-' + qNum);
  card.classList.remove('missing');
  card.classList.add('answered');
  card.querySelector('.question-num').textContent = '‚úì';
  
  btn.closest('.scale-options').querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  updateProgress();
}

function checkAndAdvance() {
  const mod = pageModules[currentModIdx];
  const missing = mod.questions.filter(q => !answers[q]);
  
  if (missing.length > 0) {
    missing.forEach(q => document.getElementById('qcard-' + q).classList.add('missing'));
    alert(`‚ö†Ô∏è Aten√ß√£o: Faltam ${missing.length} quest√µes nesta p√°gina. Preencha as destacadas em vermelho.`);
    document.getElementById('qcard-' + missing[0]).scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }
  
  if (currentModIdx < pageModules.length - 1) {
    renderModule(currentModIdx + 1);
  } else {
    showResults();
  }
}

function showResults() {
  showScreen('screenResults');
  window.scrollTo(0, 0);

  const nome = document.getElementById('pNome').value || '‚Äî';
  const idade = document.getElementById('pIdade').value || '‚Äî';
  const data = document.getElementById('pData').value || '‚Äî';
  const prof = document.getElementById('pProfissao').value || '‚Äî';
  const dataFmt = data ? new Date(data + 'T12:00:00').toLocaleDateString('pt-BR') : '‚Äî';

  // Mantendo o SEU HTML exato do patient-summary
  document.getElementById('patientSummary').innerHTML = `
    <div class="info-item"><label>Nome</label><span>${nome}</span></div>
    <div class="info-item"><label>Idade</label><span>${idade}</span></div>
    <div class="info-item"><label>Data</label><span>${dataFmt}</span></div>
    <div class="info-item"><label>Profiss√£o</label><span>${prof}</span></div>
    <div class="info-item"><label>Total respondido</label><span>${Object.keys(answers).length} / 212</span></div>
  `;

  // Renderizando os 18 dom√≠nios originais com o SEU HTML exato
  let scoresHtml = '';
  domains.forEach(domain => {
    const qs = domain.questions.filter(q => answers[q] !== undefined);
    if (qs.length === 0) return;
    
    const total = qs.reduce((sum, q) => sum + answers[q], 0);
    const avg = (total / qs.length).toFixed(2);
    const pct = ((avg - 1) / 5) * 100;
    const scoreClass = avg < 2.5 ? 'score-low' : avg < 4 ? 'score-mid' : 'score-high';
    
    scoresHtml += `
      <div class="domain-score-card ${scoreClass}">
        <div class="domain-score-name">
          ${domain.name}
          <small>${qs.length} quest√µes respondidas</small>
        </div>
        <div class="domain-bar-wrap">
          <div class="domain-bar-track">
            <div class="domain-bar-fill" style="width:${pct}%"></div>
          </div>
          <div class="domain-score-val">${avg} <span style="font-size:11px;font-weight:300;color:var(--gray-mid)">/ 6</span></div>
        </div>
      </div>`;
  });
  document.getElementById('domainScores').innerHTML = scoresHtml;
}

async function sendToSupabase() {
  const statusEl = document.getElementById('sendStatus');
  const btn = document.getElementById('btn-enviar');
  
  btn.disabled = true;
  btn.textContent = 'Enviando...';
  statusEl.style.display = 'block';
  statusEl.style.backgroundColor = '#F0EDE7';
  statusEl.style.color = '#4A2F26';
  statusEl.textContent = 'Conectando ao Consult√≥rio Virtual...';

  // Gerar o texto dos resultados usando os 18 dom√≠nios
  let scoresText = domains.map(d => {
      const qInD = d.questions;
      const avg = (qInD.reduce((s, q) => s + (answers[q]||0), 0) / qInD.length).toFixed(2);
      return `${d.name}: ${avg}`;
  }).join(' | ');

  try {
    const response = await fetch('https://nyelqgsqpqoasywdioxi.supabase.co/rest/v1/clientes', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': 'sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX',
        'Authorization': 'Bearer sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX',
        'Prefer': 'return=minimal'
      },
      body: JSON.stringify({
        nome_completo: document.getElementById('pNome').value,
        anotacoes: `Idade: ${document.getElementById('pIdade').value} | Profiss√£o: ${document.getElementById('pProfissao').value}`,
        origem: "Invent√°rio de Esquemas",
        resultados_teste: { dominios: scoresText, data: new Date().toLocaleDateString() }
      })
    });

    if (response.ok) {
      statusEl.style.backgroundColor = '#E8F0E4';
      statusEl.style.color = '#687C5A';
      statusEl.textContent = '‚úÖ Sucesso! O diagn√≥stico foi salvo no seu prontu√°rio.';
      btn.textContent = 'Sincronizado ‚úî';
    } else { throw new Error('Falha no Supabase'); }
  } catch (err) {
    statusEl.style.backgroundColor = '#F0E4E4';
    statusEl.style.color = '#A84848';
    statusEl.textContent = '‚ùå Erro ao salvar. Por favor, tente novamente ou gere o PDF.';
    btn.disabled = false;
    btn.textContent = 'Tentar Novamente';
  }
}
</script>
</body>
</html>
