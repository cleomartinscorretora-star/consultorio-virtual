<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Invent√°rio de Esquemas de Young - Cleo Martins</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --cream: #F7F4EF;
    --sage: #4A2F26;
    --terracotta: #C38A6B;
    --gray-mid: #7A6560;
    --border: #E4DDD5;
    --shadow: rgba(74,47,38,0.07);
    --error-red: #A84848;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--cream); color: var(--sage); min-height: 100vh; font-size: 15px; }

  /* HEADER */
  .header { background: #F7F4EF; border-bottom: 1px solid var(--border); padding: 18px 32px; display: flex; align-items: center; gap: 14px; position: sticky; top: 0; z-index: 100; box-shadow: 0 1px 8px var(--shadow); }
  .header-logo { width: 36px; height: 36px; background: var(--sage); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .header-title { font-family: 'Lora', serif; font-size: 17px; font-weight: 600; }
  .progress-bar-wrap { margin-left: auto; display: flex; align-items: center; gap: 12px; min-width: 200px; }
  .progress-track { flex:1; height: 6px; background: #DDD8D0; border-radius: 99px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--sage); transition: width 0.4s ease; width: 0%; }

  /* INTRO & FORMS */
  .container-wide { max-width: 760px; margin: 60px auto; padding: 0 24px; }
  .screen { display: none; }
  .screen.active { display: block; }
  .intro-heading { font-family: 'Lora', serif; font-size: 38px; margin-bottom: 24px; }
  .instructions-box, .patient-form { background: #FFF; border: 1px solid var(--border); border-radius: 16px; padding: 32px; margin-bottom: 30px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 15px; }
  .form-group label { font-size: 11px; text-transform: uppercase; color: var(--gray-mid); font-weight: 600; display: block; margin-bottom: 5px; }
  .form-group input { width: 100%; border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: var(--cream); outline: none; }

  /* QUESTION CARDS */
  .question-card { background: #FFF; border: 1px solid var(--border); border-radius: 14px; padding: 24px; margin-bottom: 16px; transition: 0.2s; }
  .question-card.answered { border-color: #D4C8C2; box-shadow: 0 2px 8px var(--shadow); }
  .question-card.missing { border: 2px solid var(--error-red); background: #FFF9F9; }
  .question-num { width: 28px; height: 28px; border: 1.5px solid #DDD; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; margin-bottom: 15px; }
  .question-card.answered .question-num { background: var(--terracotta); border-color: var(--terracotta); color: #FFF; }
  .question-text { font-size: 15px; line-height: 1.6; margin-bottom: 20px; }

  /* SCALE BUTTONS WITH LABELS */
  .scale-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .scale-btn { 
    background: var(--cream); border: 1.5px solid var(--border); border-radius: 10px; padding: 12px 8px; cursor: pointer; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .scale-btn strong { font-size: 16px; margin-bottom: 2px; }
  .scale-btn span { font-size: 9px; line-height: 1.2; color: var(--gray-mid); font-weight: 400; }
  .scale-btn.selected { background: var(--sage); border-color: var(--sage); color: #FFF; }
  .scale-btn.selected span { color: #EEE; }

  /* NAVIGATION */
  .btn-action { width: 100%; padding: 16px; background: var(--sage); color: #FFF; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 16px; transition: 0.2s; }
  .btn-action:hover { background: #321f18; }
  .nav-row { display: flex; justify-content: space-between; gap: 20px; margin-top: 30px; }
  .btn-nav { padding: 14px 24px; border-radius: 10px; border: 1.5px solid var(--border); cursor: pointer; font-weight: 500; }
  .btn-nav.primary { background: var(--sage); color: #FFF; border: none; }

  /* RESULTS */
  .patient-summary { background: #FFF; border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 30px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
  .score-card { background: #FFF; border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
  .bar-track { flex: 1; height: 8px; background: #EEE; border-radius: 10px; overflow: hidden; }
  .bar-fill { height: 100%; background: var(--terracotta); transition: width 0.8s ease; }

  @media (min-width: 600px) { .scale-options { grid-template-columns: repeat(6, 1fr); } }
</style>
</head>
<body>

<div class="header">
  <div class="header-logo"><svg viewBox="0 0 24 24" width="18" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H7l5-8v4h4l-5 8z"/></svg></div>
  <div><div class="header-title">Invent√°rio de Esquemas</div><div class="header-subtitle">Cleo Martins - Psicoterapia Integrativa</div></div>
  <div class="progress-bar-wrap" id="pWrap" style="display:none"><div class="progress-track"><div class="progress-fill" id="pFill"></div></div><div class="progress-text" id="pText" style="font-size:12px; color:var(--gray-mid); font-weight:500;">0 / 212</div></div>
</div>

<div class="container-wide">
  <div class="screen active" id="scrIntro">
    <h1 class="intro-heading">Jornada de<br><em>Autoconhecimento</em></h1>
    <div class="instructions-box">
      <h3 style="margin-bottom:10px">üìã Como responder</h3>
      <p style="font-size:14px; color:var(--gray-mid); line-height:1.6">Responda com base no que voc√™ <strong>sente emocionalmente</strong>. O teste possui 212 quest√µes divididas em m√≥dulos. Voc√™ s√≥ avan√ßar√° para o pr√≥ximo m√≥dulo ap√≥s completar a p√°gina atual.</p>
    </div>
    <div class="patient-form">
      <h3>Dados da Paciente</h3>
      <div class="form-row">
        <div class="form-group"><label>Nome Completo</label><input type="text" id="pNome" placeholder="Seu nome"></div>
        <div class="form-group"><label>Idade</label><input type="number" id="pIdade" placeholder="Ex: 48"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Data</label><input type="date" id="pData"></div>
        <div class="form-group"><label>Profiss√£o</label><input type="text" id="pProfissao" placeholder="Sua profiss√£o"></div>
      </div>
    </div>
    <button class="btn-action" onclick="startQuiz()">Iniciar Invent√°rio ‚Üí</button>
  </div>

  <div class="screen" id="scrQuest">
    <div id="qWrap"></div>
  </div>

  <div class="screen" id="scrRes">
    <div class="results-header" style="text-align:center; margin-bottom:30px">
      <h2 style="font-family:Lora; font-size:28px">Avalia√ß√£o Conclu√≠da</h2>
      <p style="color:var(--gray-mid)">Seu mapa emocional foi gerado com sucesso.</p>
    </div>
    <div class="patient-summary" id="pSumm"></div>
    <div id="dScores"></div>
    <div style="background:#F7F4EF; padding:30px; border-radius:16px; text-align:center; margin-top:30px">
      <h3>Sincronizar Prontu√°rio</h3>
      <p style="font-size:13px; margin-bottom:20px">Os dados ser√£o enviados de forma segura para o Consult√≥rio Virtual.</p>
      <button id="btnEnv" class="btn-action" style="max-width:300px" onclick="sendToSupabase()">Enviar Resultados</button>
      <button onclick="window.print()" class="btn-nav" style="margin-top:15px; display:block; width:100%; max-width:300px; margin-left:auto; margin-right:auto">üñ®Ô∏è Gerar Relat√≥rio PDF</button>
      <div id="sStat" style="margin-top:15px; font-size:13px; display:none"></div>
    </div>
  </div>
</div>

<script>
// ESCALA DE AVALIA√á√ÉO
const scaleLabels = ["","Inteiramente falsa","Em grande parte falsa","Levemente mais verdadeira","Moderadamente verdadeira","Em grande parte verdadeira","Descreve perfeitamente"];

const domains = [
  { key:"pe", name:"Desconex√£o e Rejei√ß√£o", questions:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,
