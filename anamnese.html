<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anamnese Terapêutica - Cleo Martins</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #F7F4EF;
            --text-main: #4A2F26;
            --accent: #C38A6B;
            --border: #E4DDD5;
        }
        body { background: var(--bg-color); color: var(--text-main); font-family: 'DM Sans', sans-serif; line-height: 1.6; padding: 40px 20px; }
        .container { max-width: 700px; margin: 0 auto; background: #FFF; padding: 60px; border-radius: 20px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.03); }
        h1 { font-family: 'Lora', serif; font-size: 32px; font-weight: 400; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; font-size: 13px; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); margin-bottom: 50px; }
        
        section { margin-bottom: 40px; border-bottom: 1px solid var(--border); padding-bottom: 30px; }
        h3 { font-family: 'Lora', serif; font-size: 20px; margin-bottom: 25px; color: var(--accent); }
        
        .form-group { margin-bottom: 25px; }
        label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        input[type="text"], input[type="date"], input[type="email"], select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: #FCFAFA; font-size: 15px; outline: none;
        }
        textarea { height: 120px; resize: vertical; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .radio-group { display: flex; align-items: center; gap: 10px; font-size: 14px; margin-bottom: 8px; cursor: pointer; }
        
        .scale-container { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .btn-submit { width: 100%; padding: 18px; background: #4A2F26; color: #FFF; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; transition: 0.3s; margin-top: 30px; }
        .btn-submit:hover { background: #321f18; }
        
        #msgSucesso { display: none; text-align: center; padding: 40px; }
        #msgSucesso h2 { font-family: 'Lora', serif; color: var(--accent); }
    </style>
</head>
<body>

<div class="container" id="formContainer">
    <h1>Anamnese Terapêutica</h1>
    <p class="subtitle">Cleo Martins - Desbloqueio do Feminino</p>

    <form id="anamneseForm">
        <section>
            <h3>1. Dados Pessoais</h3>
            <div class="form-group"><label>Nome Completo *</label><input type="text" name="nome" required></div>
            <div class="form-group"><label>Data de Nascimento *</label><input type="date" name="nascimento" required></div>
            <div class="form-group">
                <label>Estado Civil *</label>
                <select name="estado_civil" required>
                    <option value="">Selecione...</option>
                    <option>Solteira</option><option>Em relacionamento</option>
                    <option>Casada</option><option>Divorciada</option><option>Viúva</option>
                </select>
            </div>
            <div class="form-group"><label>Telefone / WhatsApp *</label><input type="text" name="whatsapp" required></div>
        </section>

        <section>
            <h3>2. Motivo e Momento Atual</h3>
            <div class="form-group"><label>O que te trouxe para este processo neste momento da sua vida? *</label><textarea name="motivo" required></textarea></div>
            <div class="form-group"><label>O que mais está doendo emocionalmente hoje? *</label><textarea name="dor_atual" required></textarea></div>
        </section>

        <section>
            <h3>3. Infância e Raiz Emocional</h3>
            <div class="form-group"><label>Como foi sua relação com sua mãe? *</label><textarea name="relacao_mae" required></textarea></div>
            <div class="form-group"><label>Como foi sua relação com seu pai? *</label><textarea name="relacao_pai" required></textarea></div>
            <div class="form-group"><label>Houve algum momento em que você se sentiu profundamente rejeitada ou invisível? *</label><textarea name="rejeicao" required></textarea></div>
        </section>

        <section>
            <h3>4. Relacionamentos Amorosos</h3>
            <div class="form-group">
                <label>Você tem medo de abandono? *</label>
                <div class="options-grid">
                    <label class="radio-group"><input type="radio" name="medo_abandono" value="Sim"> Sim</label>
                    <label class="radio-group"><input type="radio" name="medo_abandono" value="Não"> Não</label>
                    <label class="radio-group"><input type="radio" name="medo_abandono" value="Às vezes"> Às vezes</label>
                </div>
            </div>
        </section>

        <button type="submit" class="btn-submit" id="btnEnviar">Enviar Anamnese</button>
    </form>
</div>

<div class="container" id="msgSucesso">
    <h2>Recebido com carinho.</h2>
    <p style="margin-top:20px">Sua história foi registrada. Nos vemos em breve na nossa sessão.</p>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const pacienteId = urlParams.get('id');

    document.getElementById('anamneseForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        btn.disabled = true; btn.innerText = "Enviando...";

        const formData = new FormData(e.target);
        let textoFinal = "--- RESUMO DA ANAMNESE ---\n\n";
        formData.forEach((value, key) => {
            textoFinal += `${key.toUpperCase()}: ${value}\n`;
        });

        try {
            const resp = await fetch(`https://nyelqgsqpqoasywdioxi.supabase.co/rest/v1/clientes?id=eq.${pacienteId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': 'sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX',
                    'Authorization': 'Bearer sb_publishable_IVMMnw4_9uF4C6-RBiElUg_lvIq8JRX'
                },
                body: JSON.stringify({ anamnese: textoFinal })
            });

            if(resp.ok) {
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('msgSucesso').style.display = 'block';
            }
        } catch (e) { alert("Erro ao enviar. Tente novamente."); btn.disabled = false; }
    };
</script>
</body>
</html>
